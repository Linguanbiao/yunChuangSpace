{"ast":null,"code":"//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport MessageArea from \"@/components/MessageArea\";\nimport fetch from \"@/mixins/fetchData.js\";\nimport { postComment, getComment } from \"@/api/blog.js\";\nimport Loading from \"@/components/Loading.vue\";\nexport default {\n  mixins: [fetch({})],\n  components: {\n    MessageArea,\n    Loading\n  },\n\n  data() {\n    return {\n      page: 1,\n      limit: 10\n    };\n  },\n\n  computed: {\n    hasMore() {\n      // 判断是否还有剩余的数据，当 data.rows.length 小于总数时，就表示还有数据的， 该计算属性用于指导还能否加载更多的评论数据\n      if (this.data.rows) {\n        return this.data.rows.length < this.data.total;\n      }\n\n      return false;\n    }\n\n  },\n\n  created() {\n    // 利用时间总线， 监听滚动条的改变，并触发事件 handleSroll\n    this.$bus.$on(\"mainScroll\", this.handleScroll);\n  },\n\n  methods: {\n    fetchData() {\n      return getComment(this.$route.params.id, this.page, this.limit);\n    },\n\n    // 加载下一页，获得更多的数据\n    async fetchMoreDate() {\n      if (!this.hasMore) {\n        // 没有更多的评论数据了\n        return;\n      }\n\n      this.isLoading = true;\n      this.page++;\n      const resp = await this.fetchData();\n      this.data.total = resp.total;\n      this.data.rows = this.data.rows.concat(resp.rows);\n      this.isLoading = false;\n    },\n\n    async handleSubmit(formData, callback) {\n      // 父组件可以处理了，提交一条评论\n      const resp = await postComment({\n        blogId: this.$route.params.id,\n        nickname: formData.nickname,\n        content: formData.content\n      });\n      this.data.rows.unshift(resp);\n      this.data.total++; //父组件处理完了，执行回掉函数，并传递一个参数\n\n      callback(\"评论成功\");\n    },\n\n    handleScroll(dom) {\n      if (this.isLoading) {\n        // 如果当前还正在加载就不需要继续加载了，防止事件一直在发生\n        return;\n      } // 当滚动条滚动到底部时，触发 fetchMoreData()\n\n\n      const range = 50; // 一个可接受的范围，在这个范围内都滚动条算到达了底部\n\n      const gap = Math.abs(dom.scrollTop + dom.clientHeight - dom.scrollHeight);\n\n      if (gap < range) {\n        this.fetchMoreDate();\n      }\n    }\n\n  }\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;AAiBA;AACA;AACA;AACA;AACA;EACAA,mBADA;EAEAC;IACAC,WADA;IAEAC;EAFA,CAFA;;EAMAC;IACA;MACAC,OADA;MAEAC;IAFA;EAIA,CAXA;;EAYAC;IACAC;MACA;MACA;QACA;MACA;;MACA;IACA;;EAPA,CAZA;;EAqBAC;IACA;IACA;EACA,CAxBA;;EAyBAC;IACAC;MACA;IACA,CAHA;;IAIA;IAEA;MACA;QACA;QACA;MACA;;MACA;MACA;MACA;MACA;MACA;MACA;IACA,CAjBA;;IAkBA;MACA;MACA;QACAC,6BADA;QAEAC,2BAFA;QAGAC;MAHA;MAKA;MACA,kBARA,CASA;;MACAC;IACA,CA7BA;;IA8BAC;MACA;QACA;QACA;MACA,CAJA,CAKA;;;MACA,iBANA,CAMA;;MACA;;MACA;QACA;MACA;IACA;;EAzCA;AAzBA","names":["mixins","components","MessageArea","Loading","data","page","limit","computed","hasMore","created","methods","fetchData","blogId","nickname","content","callback","handleScroll"],"sourceRoot":"src/views/Blog/BlogDetails","sources":["BlogComment.vue"],"sourcesContent":["<template>\n  <div class=\"blog-comment-container\">\n    <MessageArea\n      title=\"评论列表\"\n      :subTitle=\"data.total + ''\"\n      :list=\"data.rows\"\n      :isListLoading=\"isLoading\"\n      @submit=\"handleSubmit\"\n    ></MessageArea>\n    <div class=\"Loding\">\n      <Loading v-if=\"isLoading\"></Loading>\n      <span v-if=\"!hasMore\" class=\"noComment\">没有更多的评论了</span>\n    </div>\n  </div>\n</template>\n\n<script>\nimport MessageArea from \"@/components/MessageArea\";\nimport fetch from \"@/mixins/fetchData.js\";\nimport { postComment, getComment } from \"@/api/blog.js\";\nimport Loading from \"@/components/Loading.vue\";\nexport default {\n  mixins: [fetch({})],\n  components: {\n    MessageArea,\n    Loading,\n  },\n  data() {\n    return {\n      page: 1,\n      limit: 10,\n    };\n  },\n  computed: {\n    hasMore() {\n      // 判断是否还有剩余的数据，当 data.rows.length 小于总数时，就表示还有数据的， 该计算属性用于指导还能否加载更多的评论数据\n      if (this.data.rows) {\n        return this.data.rows.length < this.data.total;\n      }\n      return false;\n    },\n  },\n  created() {\n    // 利用时间总线， 监听滚动条的改变，并触发事件 handleSroll\n    this.$bus.$on(\"mainScroll\", this.handleScroll);\n  },\n  methods: {\n    fetchData() {\n      return getComment(this.$route.params.id, this.page, this.limit);\n    },\n    // 加载下一页，获得更多的数据\n\n    async fetchMoreDate() {\n      if (!this.hasMore) {\n        // 没有更多的评论数据了\n        return;\n      }\n      this.isLoading = true;\n      this.page++;\n      const resp = await this.fetchData();\n      this.data.total = resp.total;\n      this.data.rows = this.data.rows.concat(resp.rows);\n      this.isLoading = false;\n    },\n    async handleSubmit(formData, callback) {\n      // 父组件可以处理了，提交一条评论\n      const resp = await postComment({\n        blogId: this.$route.params.id,\n        nickname: formData.nickname,\n        content: formData.content,\n      });\n      this.data.rows.unshift(resp);\n      this.data.total++;\n      //父组件处理完了，执行回掉函数，并传递一个参数\n      callback(\"评论成功\");\n    },\n    handleScroll(dom) {\n      if (this.isLoading) {\n        // 如果当前还正在加载就不需要继续加载了，防止事件一直在发生\n        return;\n      }\n      // 当滚动条滚动到底部时，触发 fetchMoreData()\n      const range = 50; // 一个可接受的范围，在这个范围内都滚动条算到达了底部\n      const gap = Math.abs(dom.scrollTop + dom.clientHeight - dom.scrollHeight);\n      if (gap < range) {\n        this.fetchMoreDate();\n      }\n    },\n  },\n};\n</script>\n\n<style lang=\"less\" scoped>\n@import \"~@/style/var.less\";\n@import \"~@/style/mix.less\";\n.blog-comment-container {\n  margin: 30px 10px;\n}\n.Loding {\n  height: 130px;\n  width: 100%;\n  position: relative;\n}\n.noComment {\n  color: @gray;\n  font-size: 16px;\n  .self-center();\n}\n</style>\n"]},"metadata":{},"sourceType":"module"}